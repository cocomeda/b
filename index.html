<html>
<head>
  <title>くじ引き</title>
  <style>
    #overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 100;
    }
    #popup {
        display: none;


        transform: translate(-50%, -50%);
        width: 50vw; /* 固定幅 */
        height: 50vw; /* 固定高さ */
        padding: 1vw;
        border: 0.5vw solid #ccc;
        background-color: #fff;
        box-shadow: 0px 0px 1vw rgba(0, 0, 0, 0.2);
        z-index: 101;
        display: flex;

    }
    #popup-message {
        text-align: center; /* テキストを中央揃え */
        margin-bottom: 2vw; /* ボタンとの間隔 */
    }
    #popup button {
        margin-top: 2vw; /* メッセージとボタンの間隔 */
        width: auto; /* 幅は自動 */
        padding: 1vw;
        font-size: 3vw; /* ボタンのフォントサイズを設定 */
        border: none;
        background-color: #007bff;
        color: white;
        cursor: pointer;
        border-radius: 0.5vw;
        transition: background-color 0.3s ease;
    }
    #popup button:hover {
        background-color: #0056b3;
    }
    #popup-close {
        position: absolute;
        top: 1vw;
        right: 1vw;
        font-size: 3vw;
        cursor: pointer;
        background: none;
        border: none;
        color: #333;
        transition: color 0.3s ease;
    }
    #popup-close:hover {
        color: #007bff;
    }
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    .button-container {
        display: flex;
        justify-content: space-between; /* ボタンを横に均等に並べる */
        padding: 1vw; /* コンテナ内の余白 */
        box-sizing: border-box; /* パディングを幅に含める */
    }
    .img-button {
        width: 30vw; /* ビューポート幅の30% */
        height: 30vw; /* 高さは自動調整 */
        border: none;
        border-radius: 2vw;
        cursor: pointer;
        transition: opacity 0.3s ease;
    }
    .img-button:hover {
        opacity: 0.8;
    }
    a {
        display: block;
        text-decoration: none;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
</head>
<body>
  <h1>くじ引き</h1>
  <div id="overlay" onclick="closePopup()"></div>
  <div id="popup">
    <button id="popup-close" onclick="closePopup()">×</button>
    <div id="popup-message"></div>
  </div>

  <div class="button-container">
    <img src="lotte2.jpg" class="img-button" alt="くじ" onclick="initializeLiff0003()">
  </div>

  <br><br><br>
  <h1 class="honbun"></h1>
  <h1 class="honbun"></h1>
  <h1 class="m1">© Coco Medaka35</h1>

  <script>
    function initializeLiff0003() {
      liff.init({ liffId: '1657196041-0B5JEMmG' })
        .then(() => {
          if (liff.isLoggedIn()) {
            sendIdTokenToGAS_00A3(); // IDトークンをGASに送信する関数を呼び出す
          } else {
            liff.login(); // ログインしていない場合はログインページにリダイレクト
          }
        })
        .catch(error => {
          console.error('LIFFの初期化エラー:', error);
          alert('LIFFの初期化に失敗しました。');
        });
    }

    async function sendIdTokenToGAS_00A3() {
      try {
        const idToken = await liff.getIDToken();
        const response = await fetch('https://script.google.com/macros/s/AKfycbzHen5flQ04oJsGjIjLmF13dz_rui9b5JLe2QvvErOLosgS47yawhd6TQH52TxZY6qH/exec', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: new URLSearchParams({
            'idToken': idToken
          })
        });

        if (!response.ok) {
          console.error('HTTPエラー:', response.status);
          alert('HTTPエラーが発生しました。ステータスコード: ' + response.status);
          return;
        }

        const data = await response.json();
        if (data.status === 'success') {
          showPopup(data.message);
        } else {
          showPopup('エラー: ' + data.message);
        }
      } catch (error) {
        console.error('通信エラー:', error);
        alert('通信エラーが発生しました。');
      }
    }

    function showPopup(message) {
      document.getElementById('popup-message').innerText = message;
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('popup').style.display = 'flex'; // Display flex to use centering
    }

    function closePopup() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('popup').style.display = 'none';
    }
  </script>
</body>
</html>
